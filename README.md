

# breakermux
`import "github.com/cognusion/go-breakermux"`

* [Overview](#pkg-overview)
* [Index](#pkg-index)
* [Examples](#pkg-examples)

## <a name="pkg-overview">Overview</a>
Package breakermux builds upon gobreaker (<a href="https://github.com/sony/gobreaker/">https://github.com/sony/gobreaker/</a>),
allowing for circuitbreakers to be automatically instantiated for different keys.
This could be used to 'break on URLs or hostnames, etc.

Plans include expiry of 'breakers, hence the tracking of mtime and atime.


##### Example :
``` go
// Set the timeout to 2ms, and print something nice when the state changes
var st = Settings[string]{}
st.Timeout = 2 * time.Millisecond
st.OnStateChange = func(name string, from gobreaker.State, to gobreaker.State) {
    fmt.Printf("%s: %+v -> %+v\n", name, from, to)
}

// Our ExecFunc sleeps for a half-second so it is visually obvious when it is being
// called ('breaker closed), versus skipped ('breaker open)
st.ExecClosure = func(input string) func() (string, error) {
    return func() (string, error) {
        time.Sleep(500 * time.Millisecond)
        if input == "yes" {
            return "yes", nil
        }
        return "no", fmt.Errorf("Noo")
    }
}

// Create a mux, passing it our Settings and ExecFunc
cbm := NewMux(st)

// We call "no" 20 times, but after the first 5 it will trip and fast-fail the last 15.
for i := range 20 {
    fmt.Printf("%d: ", i)
    cbm.Get("no")
}
fmt.Println()

// We call "yes" 20 times, and each will take a. half. second. to. return.
for i := range 20 {
    fmt.Printf("%d: ", i)
    cbm.Get("yes")
}
fmt.Println()
```



## <a name="pkg-index">Index</a>
* [type CircuitBreakerMux](#CircuitBreakerMux)
  * [func NewMux[T any](st Settings[T]) *CircuitBreakerMux[T]](#NewMux)
  * [func (c *CircuitBreakerMux[T]) Clear()](#CircuitBreakerMux.Clear)
  * [func (c *CircuitBreakerMux[T]) Delete(key string)](#CircuitBreakerMux.Delete)
  * [func (c *CircuitBreakerMux[T]) Get(key string) (value T, err error)](#CircuitBreakerMux.Get)
* [type ExecFunc](#ExecFunc)
* [type Settings](#Settings)

#### <a name="pkg-examples">Examples</a>
* [Package](#example-)

#### <a name="pkg-files">Package files</a>
[cbmux.go](https://github.com/cognusion/go-breakermux/tree/master/cbmux.go)






## <a name="CircuitBreakerMux">type</a> [CircuitBreakerMux](https://github.com/cognusion/go-breakermux/tree/master/cbmux.go?s=727:837#L26)
``` go
type CircuitBreakerMux[T any] struct {
    // contains filtered or unexported fields
}

```
CircuitBreakerMux is a goro-safe circuit breaker multiplex,
whereby individual keys gets their own 'breakers,
which can each be in various states.







### <a name="NewMux">func</a> [NewMux](https://github.com/cognusion/go-breakermux/tree/master/cbmux.go?s=895:951#L33)
``` go
func NewMux[T any](st Settings[T]) *CircuitBreakerMux[T]
```
NewMux requires a Settings for proper configuration.





### <a name="CircuitBreakerMux.Clear">func</a> (\*CircuitBreakerMux[T]) [Clear](https://github.com/cognusion/go-breakermux/tree/master/cbmux.go?s=1920:1958#L73)
``` go
func (c *CircuitBreakerMux[T]) Clear()
```
Clear removes all keys and 'breakers.




### <a name="CircuitBreakerMux.Delete">func</a> (\*CircuitBreakerMux[T]) [Delete](https://github.com/cognusion/go-breakermux/tree/master/cbmux.go?s=1800:1849#L68)
``` go
func (c *CircuitBreakerMux[T]) Delete(key string)
```
Delete removes a 'breaker named by key, if one exists.




### <a name="CircuitBreakerMux.Get">func</a> (\*CircuitBreakerMux[T]) [Get](https://github.com/cognusion/go-breakermux/tree/master/cbmux.go?s=1170:1237#L42)
``` go
func (c *CircuitBreakerMux[T]) Get(key string) (value T, err error)
```
Get fetches an existing 'breaker for the key, or creates a new one,
executes the ExecFunc on it, and returns accordingly.




## <a name="ExecFunc">type</a> [ExecFunc](https://github.com/cognusion/go-breakermux/tree/master/cbmux.go?s=2074:2125#L78)
``` go
type ExecFunc[T any] func(string) func() (T, error)
```
ExecFunc is a closure to allow a string to be passed to an otherwise niladic function.










## <a name="Settings">type</a> [Settings](https://github.com/cognusion/go-breakermux/tree/master/cbmux.go?s=466:569#L17)
``` go
type Settings[T any] struct {
    gobreaker.Settings
    ExecClosure ExecFunc[T]
    ExpireAfter time.Duration
}

```
Settings allows for per-mux and per-'breaker configurations.














- - -
Generated by [godoc2md](http://github.com/cognusion/godoc2md)
