

# breakermux
`import "github.com/cognusion/go-breakermux"`

* [Overview](#pkg-overview)
* [Index](#pkg-index)
* [Examples](#pkg-examples)

## <a name="pkg-overview">Overview</a>
Package breakermux builds upon [gobreaker](<a href="https://github.com/sony/gobreaker/v2/">https://github.com/sony/gobreaker/v2/</a>),
allowing for circuitbreakers to be automatically instantiated for different keys.
This could be used to 'break on URLs or hostnames, etc.


##### Example :
``` go
// Set the timeout to 2ms, and print something nice when the state changes
var st = DefaultSettings
st.Timeout = 2 * time.Millisecond
st.OnStateChange = func(name string, from gobreaker.State, to gobreaker.State) {
    fmt.Printf("%s: %+v -> %+v\n", name, from, to)
}

// Our ExecFunc sleeps for a half-second so it is visually obvious when it is being
// called ('breaker closed), versus skipped ('breaker open)
var efunc = func(input string) func() (string, error) {
    return func() (string, error) {
        time.Sleep(500 * time.Millisecond)
        if input == "yes" {
            return "yes", nil
        }
        return "no", fmt.Errorf("Noo")
    }
}

// Create a mux, passing it our Settings and ExecFunc
cbm := NewMux(st, efunc)

// We call "no" 20 times, but after the first 5 it will trip and fast-fail the last 15.
for i := range 20 {
    fmt.Printf("%d: ", i)
    cbm.Get("no")
}
fmt.Println()

// We call "yes" 20 times, and each will take a. half. second. to. return.
for i := range 20 {
    fmt.Printf("%d: ", i)
    cbm.Get("yes")
}
fmt.Println()
```



## <a name="pkg-index">Index</a>
* [Variables](#pkg-variables)
* [type CircuitBreakerMux](#CircuitBreakerMux)
  * [func NewMux[T any](st gobreaker.Settings, execfunc ExecFunc[T]) *CircuitBreakerMux[T]](#NewMux)
  * [func (c *CircuitBreakerMux[T]) Clear()](#CircuitBreakerMux.Clear)
  * [func (c *CircuitBreakerMux[T]) Delete(key string)](#CircuitBreakerMux.Delete)
  * [func (c *CircuitBreakerMux[T]) Get(key string) (value T, err error)](#CircuitBreakerMux.Get)
* [type ExecFunc](#ExecFunc)

#### <a name="pkg-examples">Examples</a>
* [Package](#example-)

#### <a name="pkg-files">Package files</a>
[cbmux.go](https://github.com/cognusion/go-breakermux/tree/master/cbmux.go)



## <a name="pkg-variables">Variables</a>
``` go
var DefaultSettings gobreaker.Settings
```
DefaultSettings is exactly that, so implementors need not import
gobreaker directly.




## <a name="CircuitBreakerMux">type</a> [CircuitBreakerMux](https://github.com/cognusion/go-breakermux/tree/master/cbmux.go?s=613:723#L21)
``` go
type CircuitBreakerMux[T any] struct {
    // contains filtered or unexported fields
}

```
CircuitBreakerMux is a goro-safe circuit breaker multiplex,
whereby individual keys gets their own 'breakers,
which can each be in various states.







### <a name="NewMux">func</a> [NewMux](https://github.com/cognusion/go-breakermux/tree/master/cbmux.go?s=824:909#L28)
``` go
func NewMux[T any](st gobreaker.Settings, execfunc ExecFunc[T]) *CircuitBreakerMux[T]
```
NewMux requires a Settings struct to use for each 'breaker, and an ExecFunc that each will use.





### <a name="CircuitBreakerMux.Clear">func</a> (\*CircuitBreakerMux[T]) [Clear](https://github.com/cognusion/go-breakermux/tree/master/cbmux.go?s=1863:1901#L68)
``` go
func (c *CircuitBreakerMux[T]) Clear()
```
Clear removes all keys and 'breakers.




### <a name="CircuitBreakerMux.Delete">func</a> (\*CircuitBreakerMux[T]) [Delete](https://github.com/cognusion/go-breakermux/tree/master/cbmux.go?s=1743:1792#L63)
``` go
func (c *CircuitBreakerMux[T]) Delete(key string)
```
Delete removes a 'breaker named by key, if one exists.




### <a name="CircuitBreakerMux.Get">func</a> (\*CircuitBreakerMux[T]) [Get](https://github.com/cognusion/go-breakermux/tree/master/cbmux.go?s=1113:1180#L37)
``` go
func (c *CircuitBreakerMux[T]) Get(key string) (value T, err error)
```
Get fetches an existing 'breaker for the key, or creates a new one,
executes the ExecFunc on it, and returns accordingly.




## <a name="ExecFunc">type</a> [ExecFunc](https://github.com/cognusion/go-breakermux/tree/master/cbmux.go?s=2017:2068#L73)
``` go
type ExecFunc[T any] func(string) func() (T, error)
```
ExecFunc is a closure to allow a string to be passed to an otherwise niladic function.














- - -
Generated by [godoc2md](http://github.com/cognusion/godoc2md)
